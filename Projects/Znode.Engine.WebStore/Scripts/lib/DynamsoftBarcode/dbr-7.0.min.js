/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2019, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 7.0
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/Products/barcode-recognition-javascript.aspx
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(r){var p=0;return function(){return p<r.length?{done:!1,value:r[p++]}:{done:!0}}};$jscomp.arrayIterator=function(r){return{next:$jscomp.arrayIteratorImpl(r)}};$jscomp.makeIterator=function(r){var p="undefined"!=typeof Symbol&&Symbol.iterator&&r[Symbol.iterator];return p?p.call(r):$jscomp.arrayIterator(r)};
(function(r,p){"undefined"!=typeof self&&self.document&&(self.__dbrWasmCurrentScript__=document.currentScript.src.substring(0,document.currentScript.src.lastIndexOf("/")),self.__dbrLicenseKey__=document.currentScript.getAttribute("data-licenseKey"),self.__dbrProductKeys__=document.currentScript.getAttribute("data-productKeys"));"function"===typeof define&&(define.amd||define.cmd)?define(p):"object"===typeof module&&module.exports?(r=p(),module.exports=r):(p=p(),r.dynamsoft=r.dynamsoft||{},r.dynamsoft.BarcodeReader=
p,r.dynamsoft.BarcodeScanner=p.Scanner,r.dynamsoft.EnumBarcodeFormat=p.EnumBarcodeFormat,r.dynamsoft.EnumErrorCode=p.EnumErrorCode,r.dynamsoft.EnumImagePixelFormat=p.EnumImagePixelFormat,r.dynamsoft.EnumResultType=p.EnumResultType,r.dynamsoft.EnumTerminateStage=p.EnumTerminateStage,r.dynamsoft.EnumConflictMode=p.EnumConflictMode,r.Dynamsoft=r.Dynamsoft||{},r.Dynamsoft.BarcodeReader=p,r.Dynamsoft.BarcodeScanner=p.Scanner,r.Dynamsoft.EnumBarcodeFormat=p.EnumBarcodeFormat,r.Dynamsoft.EnumErrorCode=p.EnumErrorCode,
r.Dynamsoft.EnumImagePixelFormat=p.EnumImagePixelFormat,r.Dynamsoft.EnumResultType=p.EnumResultType,r.Dynamsoft.EnumTerminateStage=p.EnumTerminateStage,r.Dynamsoft.EnumConflictMode=p.EnumConflictMode,r.BarcodeReader=r.BarcodeReader||p,r.BarcodeScanner=r.BarcodeScanner||p.Scanner,r.dbr=r.dbr||p)})(this,function(){var r=function(){var a=function(){this._queue=[];this.isWorking=!1;this.timeout=100};a.prototype.push=function(a,b,d){this._queue.push({task:a,context:b,args:d});this.isWorking||this.next()};
a.prototype.unshift=function(a,b,d){this._queue.unshift({task:a,context:b,args:d});this.isWorking||this.next()};a.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var a=this._queue.shift(),b=a.task,d=a.context?a.context:null,m=a.args?a.args:[];setTimeout(function(){b.apply(d,m)},this.timeout)}};return a}(),p,A;if("undefined"!=typeof self){var w=self;self.document?p=!0:A=!0}else{w=global;var u=!0}var E=function(a,c){var b={"M+":a.getUTCMonth()+1,"d+":a.getUTCDate(),
"h+":a.getUTCHours(),"m+":a.getUTCMinutes(),"s+":a.getUTCSeconds(),"q+":Math.floor((a.getUTCMonth()+3)/3),S:a.getUTCMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in b)(new RegExp("("+d+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?b[d]:("00"+b[d]).substr((""+b[d]).length)));return c},a=function(){var a=w,c=function(a){a=a||c.productKeys||c.licenseKey||"";if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'Constructor BarcodeReader(productKeys)': Type of 'productKeys' should be 'String'.");
this._productKeys=a;if(!c.isLoaded())throw Error("'Constructor BarcodeReader(productKeys)': Autoload haven't start or you want to call `loadWasm` manually.");p||(this._instance=new c._BarcodeReaderWasm(a),8==a.length&&this._instance.InitSettingsFromServer(JSON.stringify({key:a,licenseinfo:c._runtimeLicenseResponse.licenseinfo,bDebug:!!c._bWasmRuntimeLicenseDebug,initTime:E(new Date,"yyyyMMddhhmmss")})))};c._jsVersion="7.0";c._jsEditVersion="20190729";c.version="loading...(JS "+c._jsVersion+"."+c._jsEditVersion+
")";c.isLoaded=function(){return"loaded"==this._loadWasmStatus};c._dbName="dynamsoft-dbr-wasm-"+c._jsVersion;c._DB=void 0;c._licenseUrl="https://www.dynamsoft.com/api/DbrLicense/WasmGetLicense";c.licenseKey=a.__dbrLicenseKey__;c.productKeys=a.__dbrProductKeys__;c._runtimeLicenseResponse=void 0;var g=p?a.__dbrWasmCurrentScript__?__dbrWasmCurrentScript__:__dbrESMCurrentScript__:void 0;c._resourcesPath=g;c._workerName=void 0;c._wasmjsName=void 0;c._wasmName=void 0;c._workerResourcePath=void 0;c._wasmjsResourcePath=
void 0;c._wasmResourcePath=void 0;c._isShowRelDecodeTimeInResults=!1;c._bCustomWorker=void 0;c._bWithio=void 0;c._onWasmDownloaded=void 0;c._bLoadWorkerDirectlyFromUrl=void 0;c._onLog=void 0;c._canvasMaxWH=4096;c._bUseIndexDB=!0;c._bDebuggerInWorker=!1;c._indexPostUrl=0;c.createInstance=function(a){return c.loadWasm().then(function(){var f=new c(a);return p?f._createWorkerInstance():Promise.resolve(f)})};var d=c._workerCallbackDic={};c._loadWorker=function(){return new Promise(function(a,e){var f=
c._workerName||"dbr-"+c._jsVersion+".min.js";if(c._workerResourcePath||c._resourcesPath){var b=c._workerResourcePath||c._resourcesPath;"/"!=b.charAt(b.length-1)&&(b+="/");void 0===c._bLoadWorkerDirectlyFromUrl&&location&&location.origin&&0==c._resourcesPath.indexOf(location.origin)&&(c._bLoadWorkerDirectlyFromUrl=!0);f=b+f}Promise.resolve().then(function(){return c._bLoadWorkerDirectlyFromUrl?f:fetch(f).then(function(a){return a.blob()}).then(function(a){return URL.createObjectURL(a)})}).then(function(f){var b=
c._dbrWorker=new Worker(f);b.onerror=function(a){a="worker error, you should host the page in web service: "+a.message;c._onLog&&c._onLog(a);e(a)};b.onmessage=function(b){b=b.data;switch(b.type){case "log":c._onLog&&c._onLog(b.message);break;case "load":b.success?(c.version=b.version,c._defaultRuntimeSettings=b._defaultRuntimeSettings,c._onLog&&c._onLog("load dbr worker success"),a()):e(b.exception);c._bLoadWorkerDirectlyFromUrl||URL.revokeObjectURL(f);break;case "task":try{d[b.id](b.body),d[b.id]=
void 0}catch(l){throw d[b.id]=void 0,l;}break;default:c._onLog&&c._onLog(b)}};var k=document.createElement("a");k.href=c._resourcesPath||"./";var h=void 0;c._wasmjsResourcePath&&(h=document.createElement("a"),h.href=c._wasmjsResourcePath||"./",h=h.href);var x=void 0;c._wasmResourcePath&&(x=document.createElement("a"),x.href=c._wasmResourcePath||"./",x=x.href);b.postMessage({type:"loadWorker",_licenseUrl:c._licenseUrl,productKeys:c.productKeys,_resourcesPath:k.href,_wasmjsResourcePath:h,_wasmResourcePath:x,
_bUseIndexDB:c._bUseIndexDB,_bDebuggerInWorker:c._bDebuggerInWorker,_bWasmRuntimeLicenseDebug:c._bWasmRuntimeLicenseDebug,origin:location.origin})}).catch(function(a){e(a)})})};c.prototype._createWorkerInstance=function(){var a=this;return new Promise(function(f,b){var e=Math.random();d[e]=function(e){return e.success?e.instanceID?(a._instanceID=e.instanceID,f(a)):b(c.BarcodeReaderException(c.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.")):b(e.exception)};c._dbrWorker.postMessage({type:"createInstance",
id:e,productKeys:a._productKeys})})};c.prototype.destroy=c.prototype.deleteInstance=function(){var a=this;if(this._instance)this._instance.delete();else if(this._instanceID)return new Promise(function(f,b){var e=Math.random();d[e]=function(a){return a.success?f():b(a.exception)};c._dbrWorker.postMessage({type:"deleteInstance",id:e,instanceID:a._instanceID})})};c.prototype._decodeBlob=function(f,e){var c=this;if(!(a.Blob&&f instanceof Blob))return Promise.reject("'_decodeBlob(blob, config)': Type of 'blob' should be 'Blob'.");
if(p){var b=function(a){return new Promise(function(f,e){var c=URL.createObjectURL(a),b=new Image;b.dbrObjUrl=c;b.src=c;b.onload=function(){f(b)};b.onerror=function(){e(TypeError("'_decodeBlob(blob, config)': Can't convert the blob to image."))}})},d;return function(){return a.createImageBitmap?createImageBitmap(f).then(function(a){return d=a},b):b(f)}().then(function(a){return c._decodeImage(a,e)}).then(function(a){d&&d.close();return a})}return(new Promise(function(a){var e=new FileReader;e.onload=
function(){a(e.result)};e.readAsArrayBuffer(f)})).then(function(a){return c._decodeArrayBuffer(a,e)})};c.prototype._decodeArrayBuffer=function(f,e){return a.arrayBuffer&&f instanceof ArrayBuffer||a.Buffer&&f instanceof Buffer?p?this._decodeBlob(new Blob(f),e):this._decodeUint8Array(new Uint8Array(f),e):Promise.reject("'_decodeArrayBuffer(arrayBuffer, config)': Type of 'arrayBuffer' should be 'ArrayBuffer' or 'Buffer'.")};c.prototype._decodeUint8Array=function(f,e){var b=this;if(!(a.Uint8Array&&f instanceof
Uint8Array||a.Uint8ClampedArray&&f instanceof Uint8ClampedArray))return Promise.reject("'_decodeBlob(uint8Array, config)': Type of 'uint8Array' should be 'Uint8Array'.");if(p)return this._decodeBlob(new Blob(f),e);var k=e?e.templateName||"":"";return new Promise(function(a){if(c._isShowRelDecodeTimeInResults){var e=(new Date).getTime(),d=b._instance.DecodeFileInMemory(f,k);e=(new Date).getTime()-e;d=m(d);d._decodeTime=e;return a(d)}return a(m(b._instance.DecodeFileInMemory(f,k)))})};c.prototype._decodeImage=
function(f,e){var b=this;e=e||{};return(new Promise(function(e){if(!(a.HTMLImageElement&&f instanceof HTMLImageElement||a.ImageBitmap&&f instanceof ImageBitmap))throw TypeError("'_decodeImage(image, config)': Type of 'image' should be 'HTMLImageElement or ImageBitmap'.");if(f.crossOrigin&&"anonymous"!=f.crossOrigin)throw"cors";e()})).then(function(){var a=f.naturalWidth||f.width,d=f.naturalHeight||f.height,n=document.createElement("canvas"),g=void 0,h=Math.max(a,d);h>c._canvasMaxWH&&(h=c._canvasMaxWH/
h,a=Math.round(a*h),d=Math.round(d*h));h=n.getContext("2d");switch(e._videoOrientation){case 3:n.width=a;n.height=d;h.setTransform(-1,0,0,-1,a,d);break;case 6:n.width=d;n.height=a;h.setTransform(0,1,-1,0,d,0);break;case 8:n.width=d;n.height=a;h.setTransform(0,-1,1,0,0,a);break;default:n.width=a,n.height=d}h.drawImage(f,0,0,a,d);if(e.sx||e.sy||e.sWidth||e.sHeight||e.dWidth||e.dHeight){a=d=0;h=n.width;var v=n.height,m=n.width,l=n.height;void 0!=e.sx&&(d=e.sx);void 0!=e.sy&&(a=e.sy);void 0!=e.sWidth&&
(h=e.sWidth);void 0!=e.sHeight&&(v=e.sHeight);void 0!=e.dWidth&&(m=e.dWidth);void 0!=e.dHeight&&(l=e.dHeight);0<d&&1>=d&&(d=Math.round(d*n.width));0<a&&1>=a&&(a=Math.round(a*n.height));1>=h&&(h=Math.round(h*n.width));1>=v&&(v=Math.round(v*n.height));1>=m&&(m=Math.round(m*n.width));1>=l&&(l=Math.round(l*n.height));g=document.createElement("canvas");g.getContext("2d").drawImage(n,d,a,h,v,0,0,m,l)}f.dbrObjUrl&&URL.revokeObjectURL(f.dbrObjUrl);return b._decodeCanvas(g||n,e).then(function(a){if(e.bAddOriVideoCanvasToResult)for(var f=
$jscomp.makeIterator(a),b=f.next();!b.done;b=f.next())b.value.oriVideoCanvas=n;if(e.bAddSearchRegionCanvasToResult)for(f=$jscomp.makeIterator(a),b=f.next();!b.done;b=f.next())b.value.searchRegionCanvas=g;return a})})};c.prototype._decodeCanvas=function(f,e){var b=this;return(new Promise(function(e){if(!(a.HTMLCanvasElement&&f instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, config)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(f.crossOrigin&&"anonymous"!=f.crossOrigin)throw"cors";
var b=f.getContext("2d").getImageData(0,0,f.width,f.height).data;e(b)})).then(function(a){return b._decodeRawImageUint8Array(a,f.width,f.height,4*f.width,c.EnumImagePixelFormat.IPF_ARGB_8888,e)})};c.prototype._decodeVideo=c.prototype.decodeVideo=function(f,e){var b=this,c,d;e=e||{};return(new Promise(function(b){if(!(a.HTMLVideoElement&&f instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(f.crossOrigin&&"anonymous"!=
f.crossOrigin)throw"cors";var h=0,n=0,k=f.videoWidth,g=f.videoHeight,l=f.videoWidth,q=f.videoHeight;void 0!=e.sx&&(h=e.sx);void 0!=e.sy&&(n=e.sy);void 0!=e.sWidth&&(k=e.sWidth);void 0!=e.sHeight&&(g=e.sHeight);void 0!=e.dWidth&&(l=e.dWidth);void 0!=e.dHeight&&(q=e.dHeight);0<h&&1>=h&&(h=Math.round(h*f.videoWidth));0<n&&1>=n&&(n=Math.round(n*f.videoHeight));1>=k&&(k=Math.round(k*f.videoWidth));1>=g&&(g=Math.round(g*f.videoHeight));1>=l&&(l=Math.round(l*f.videoWidth));1>=q&&(q=Math.round(q*f.videoHeight));
e.bAddOriVideoCanvasToResult&&(c=document.createElement("canvas"),c.width=f.videoWidth,c.height=f.videoHeight,c.getContext("2d").drawImage(f,0,0));d=document.createElement("canvas");d.width=l;d.height=q;var t=d.getContext("2d");0==h&&0==n&&f.videoWidth==k&&f.videoHeight==g&&f.videoWidth==l&&f.videoHeight==q?t.drawImage(c||f,0,0):t.drawImage(c||f,h,n,k,g,0,0,l,q);b()})).then(function(){var a=JSON.parse(JSON.stringify(e));a.sx=void 0;a.sy=void 0;a.sWidth=void 0;a.sHeight=void 0;a.dWidth=void 0;a.dHeight=
void 0;return b._decodeCanvas(d,e)}).then(function(a){if(e.bAddOriVideoCanvasToResult)for(var f=$jscomp.makeIterator(a),b=f.next();!b.done;b=f.next())b.value.oriVideoCanvas=c;if(e.bAddSearchRegionCanvasToResult)for(f=$jscomp.makeIterator(a),b=f.next();!b.done;b=f.next())b.value.searchRegionCanvas=d;return a})};c.prototype._decodeBase64=c.prototype.decodeBase64String=function(a,e){var f=this;if(!("string"==typeof a||"object"==typeof a&&a instanceof String))return Promise.reject("'decodeBase64(base64Str, config)': Type of 'base64Str' should be 'String'.");
"data:image/"==a.substring(0,11)&&(a=a.substring(a.indexOf(",")+1));return new Promise(function(b){if(u)b(f._decodeArrayBuffer(Buffer.from(a,"base64"),e));else{for(var c=atob(a),d=c.length,h=new Uint8Array(d);d--;)h[d]=c.charCodeAt(d);p?b(f._decodeBlob(new Blob([h]),e)):b(f._decodeUint8Array(h,e))}})};c.prototype._decodeUrl=function(a,b){var f=this;return new Promise(function(e,c){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeUrl(url, config)': Type of 'url' should be 'String'.");
if(u)(a.startsWith("https")?require("https"):require("http")).get(a,function(a){if(200==a.statusCode){var d=[];a.on("data",function(a){d.push(a)}).on("end",function(){e(f._decodeArrayBuffer(Buffer.concat(d),b))})}else c("http get fail, statusCode: "+a.statusCode)});else{var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType=p?"blob":"arraybuffer";d.send();d.onloadend=function(){p?e(f._decodeBlob(d.response,b)):e(f._decodeArrayBuffer(d.response,b))};d.onerror=function(){c(d.error)}}})};c.prototype._decodeFilePath=
function(a,b){var f=this;return new Promise(function(e,c){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeFilePath(path, config)': Type of 'path' should be 'String'.");require("fs").readFile(a,function(a,d){a?c(a):e(f._decodeArrayBuffer(d,b))})})};c.prototype._decodeRawImageBlob=function(f,b,c,d,g,n){var e=this;return(new Promise(function(b,e){if(!(a.Blob&&f instanceof Blob))throw TypeError("'_decodeRawImageBlob(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Blob'.");
var c=new FileReader;c.readAsArrayBuffer(f);c.onload=function(){b(c.result)};c.onerror=function(){e(c.error)}})).then(function(a){return e._decodeRawImageUint8Array(new Uint8Array(a),b,c,d,g,n)})};c.prototype._decodeRawImageArrayBuffer=function(f,b,c,d,g,n){var e=this;return(new Promise(function(b){if(!(a.ArrayBuffer&&f instanceof ArrayBuffer))throw TypeError("'_decodeRawImageArrayBuffer(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'ArrayBuffer'.");b()})).then(function(){return e._decodeRawImageUint8Array(new Uint8Array(f),
b,c,d,g,n)})};c.prototype._decodeRawImageUint8Array=function(f,b,g,k,x,n){var e=this;return(new Promise(function(b){if(!(a.Uint8Array&&f instanceof Uint8Array||a.Uint8ClampedArray&&f instanceof Uint8ClampedArray))throw TypeError("'_decodeRawImageUint8Array(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Uint8Array'.");b()})).then(function(){var a=n?n.templateName||"":"";if(e._instance){var h=c._isShowRelDecodeTimeInResults?(new Date).getTime():void 0;try{var y=
e._instance.DecodeBuffer(f,b,g,k,x,a)}catch(z){return setTimeout(function(){console.error("wasm error!");throw z;},0),Promise.reject(z)}a=c._isShowRelDecodeTimeInResults?(new Date).getTime()-h:void 0;y=m(y);c._isShowRelDecodeTimeInResults&&(y._decodeTime=a);if(n.videoWidth&&n.videoHeight){a=1;var l=h=0;a=b/g>=n.videoWidth/n.videoHeight?n.videoHeight/g:n.videoWidth/b;h=(b*a-n.videoWidth)/2;l=(g*a-n.videoHeight)/2;for(var q=0;q<y.length;++q){var t=y[q].LocalizationResult;t.X1=t.X1*a-h;t.X2=t.X2*a-h;
t.X3=t.X3*a-h;t.X4=t.X4*a-h;t.Y1=t.Y1*a-l;t.Y2=t.Y2*a-l;t.Y3=t.Y3*a-l;t.Y4=t.Y4*a-l}}return Promise.resolve(y)}y=e._instanceID?Promise.resolve():e._createWorkerInstance();return y.then(function(){return null===e._runtimeSettings?new Promise(function(a,b){var f=Math.random();d[f]=function(f){return f.success?(e._runtimeSettings=void 0,a()):b(f.exception)};c._dbrWorker.postMessage({type:"resetRuntimeSettings",id:f,instanceID:e._instanceID})}):Promise.resolve()}).then(function(){return new Promise(function(a,
l){var h=Math.random();d[h]=function(b){return b.success?a(b.results):l(b.exception)};c._dbrWorker.postMessage({type:"decodeRawImageUint8Array",id:h,instanceID:e._instanceID,body:{buffer:f,width:b,height:g,stride:k,enumImagePixelFormat:x,config:n},_isShowRelDecodeTimeInResults:c._isShowRelDecodeTimeInResults})})})})};c.prototype.decode=c.prototype.decodeFileInMemory=function(b,e){return a.Blob&&b instanceof Blob?this._decodeBlob(b,e):a.ArrayBuffer&&b instanceof ArrayBuffer||a.Buffer&&b instanceof
Buffer?this._decodeArrayBuffer(b,e):a.Uint8Array&&b instanceof Uint8Array||a.Uint8ClampedArray&&b instanceof Uint8ClampedArray?this._decodeUint8Array(b,e):a.HTMLImageElement&&b instanceof HTMLImageElement||a.ImageBitmap&&b instanceof ImageBitmap?this._decodeImage(b,e):a.HTMLCanvasElement&&b instanceof HTMLCanvasElement?this._decodeCanvas(b,e):a.HTMLVideoElement&&b instanceof HTMLVideoElement?this._decodeVideo(b,e):"string"==typeof b||b instanceof String?"data:image/"==b.substring(0,11)?this._decodeBase64(b,
e):u?"http"==b.substring(0,4)?this._decodeUrl(b,e):this._decodeFilePath(b,e):this._decodeUrl(b,e):Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))};c.prototype._decodeRawImage=c.prototype.decodeBuffer=function(b,e,c,d,g,n){return a.Blob&&b instanceof Blob?this._decodeRawImageBlob(b,e,c,d,g,n):a.ArrayBuffer&&b instanceof
ArrayBuffer?this._decodeRawImageArrayBuffer(b,e,c,d,g,n):a.Uint8Array&&b instanceof Uint8Array||a.Uint8ClampedArray&&b instanceof Uint8ClampedArray?this._decodeRawImageUint8Array(b,e,c,d,g,n):Promise.reject(TypeError("'_decodeRawImage(source, width, height, stride, enumImagePixelFormat, config)': Type of 'source' should be 'Blob', 'ArrayBuffer' or 'Uint8Array'."))};var m=c._handleRetJsonString=function(a){a="string"==typeof a||"object"==typeof a&&a instanceof String?JSON.parse(a):a;var b=c.EnumErrorCode;
switch(a.exception){case b.DBR_SUCCESS:case b.DBR_LICENSE_INVALID:case b.DBR_LICENSE_EXPIRED:case b.DBR_1D_LICENSE_INVALID:case b.DBR_QR_LICENSE_INVALID:case b.DBR_PDF417_LICENSE_INVALID:case b.DBR_DATAMATRIX_LICENSE_INVALID:case b.DBR_DBRERR_AZTEC_LICENSE_INVALID:case b.DBR_RECOGNITION_TIMEOUT:if(a.textResult)for(b=0;b<a.textResult.length;++b){var f=a.textResult[b];try{f.BarcodeText=u?Buffer.from(f.BarcodeText,"base64").toString():atob(f.BarcodeText)}catch(k){f.BarcodeText=""}}return a.textResult||
a.settings||a.outputSettings||a;default:throw c.BarcodeReaderException(a.exception,a.description);}};c.prototype.getAllParameterTemplateNames=function(){return m(this._instance.GetAllParameterTemplateNames())};c.prototype.getRuntimeSettings=function(){return this._instance?m(this._instance.GetRuntimeSettings()):this._runtimeSettings?JSON.parse(this._runtimeSettings):JSON.parse(c._defaultRuntimeSettings)};c.prototype.updateRuntimeSettings=function(a){var b=this;if("string"==typeof a||"object"==typeof a&&
a instanceof String)var f=a;else if("object"==typeof a)f=JSON.stringify(a);else throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");if(this._instance)try{return m(this._instance.UpdateRuntimeSettings(f)),Promise.resolve()}catch(k){return Promise.reject(k)}else return Promise.resolve().then(function(){return b._instanceID?Promise.resolve():b._createWorkerInstance()}).then(function(){return new Promise(function(a,e){var g=Math.random();d[g]=
function(c){return c.success?(b._runtimeSettings=f,a()):e(c.exception)};c._dbrWorker.postMessage({type:"updateRuntimeSettings",id:g,instanceID:b._instanceID,body:{settings:f}})})}).catch(function(a){return Promise.reject(a)})};c.prototype.resetRuntimeSettings=function(){this._instance?m(this._instance.ResetRuntimeSettings()):this._runtimeSettings=null};c.prototype.outputSettingsToString=function(a){return m(this._instance.OutputSettingsToString(a||""))};c.prototype.initRuntimeSettingsWithString=function(a,
b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'initRuntimeSettingstWithString(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");m(this._instance.InitRuntimeSettingstWithString(a,b?b:2))};c.EnumBarcodeFormat={All:503318527,OneD:2047,CODE_39:1,CODE_128:2,CODE_93:4,CODABAR:8,ITF:16,EAN_13:32,EAN_8:64,UPC_A:128,UPC_E:256,INDUSTRIAL_25:512,CODE_39_EXTENDED:1024,PDF417:33554432,QR_CODE:67108864,
DATAMATRIX:134217728,AZTEC:268435456};c.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1E4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,
DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,
DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_DBRERR_AZTEC_LICENSE_INVALID:-10041};c.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9};c.EnumResultType={EDT_StandardText:0,EDT_RawText:1,EDT_CandidateText:2,EDT_PartialText:3};c.EnumTerminateStage=
{ETS_Prelocalized:0,ETS_Localized:1,ETS_Recognized:2};c.EnumConflictMode={ECM_Ignore:1,ECM_Overwrite:2};c.BarcodeReaderException=function(){return function(a,b){var e=c.EnumErrorCode.DBR_UNKNOWN;"number"==typeof a?(e=a,a=Error(b)):a=Error(a);a.code=e;return a}}();return c}();a.BarcodeReader=a;!A||a._bCustomWorker||w.onmessage||function(){var b=w;a._onLog=a._onLog||function(c){if(b.onmessage!=a._onWorkerMessage)a._onLog=void 0;else{var d=void 0;if(void 0===c)d="undefined";else{try{d=JSON.stringify(c,
function(){var a=[],b=[];return function(c,f){if("object"===typeof f&&null!==f){var e=a.indexOf(f);if(-1!==e)return"[Circular "+b[e]+"]";a.push(f);b.push(c||"root")}return f}}())}catch(m){}if(void 0===d||"{}"===d)d=c.toString()}try{postMessage({type:"log",message:d})}catch(m){b.console&&console.error(message)}}};a._onLog("have detected in worker: "+a.version);var c={};b.onmessage=a._onWorkerMessage=function(g){g=g.data;switch(g.type){case "loadWorker":(function(){a._licenseUrl=g._licenseUrl;a.productKeys=
g.productKeys;a._resourcesPath=g._resourcesPath;a._wasmjsResourcePath=g._wasmjsResourcePath;a._wasmResourcePath=g._wasmResourcePath;a._bUseIndexDB=g._bUseIndexDB;if(g._bDebuggerInWorker)debugger;a._bWasmRuntimeLicenseDebug=g._bWasmRuntimeLicenseDebug;b.__dbrOrigin=g.origin;a.loadWasm().then(function(){postMessage({type:"load",success:!0,version:a.version,_defaultRuntimeSettings:a._defaultRuntimeSettings})},function(a){postMessage({type:"load",success:!1,exception:a.message||a})})})();break;case "createInstance":(function(){try{var b=
Math.random();c[b]=new a(g.productKeys);postMessage({type:"task",id:g.id,body:{success:!0,instanceID:b}})}catch(m){postMessage({type:"task",id:g.id,body:{success:!1,exception:m.message||m}})}})();break;case "deleteInstance":try{c[g.instanceID].deleteInstance(),c[g.instanceID]=void 0,postMessage({type:"task",id:g.id,body:{success:!0}})}catch(d){postMessage({type:"task",id:g.id,body:{success:!1,exception:d.message||d}})}break;case "decodeRawImageUint8Array":(function(){try{a._isShowRelDecodeTimeInResults=
g._isShowRelDecodeTimeInResults;var b=g.body;c[g.instanceID]._decodeRawImageUint8Array(b.buffer,b.width,b.height,b.stride,b.enumImagePixelFormat,b.config).then(function(a){postMessage({type:"task",id:g.id,body:{success:!0,results:a}})}).catch(function(a){postMessage({type:"task",id:g.id,body:{success:!1,exception:a.message||a}})})}catch(m){postMessage({type:"task",id:g.id,body:{success:!1,exception:m.message||m}})}})();break;case "getRuntimeSettings":(function(){try{var a=c[g.instanceID].getRuntimeSettings();
postMessage({type:"task",id:g.id,body:{success:!0,settings:a}})}catch(m){postMessage({type:"task",id:g.id,body:{success:!1,exception:m.message||m}})}})();break;case "updateRuntimeSettings":try{c[g.instanceID].updateRuntimeSettings(g.body.settings),postMessage({type:"task",id:g.id,body:{success:!0}})}catch(d){postMessage({type:"task",id:g.id,body:{success:!1,exception:d.message||d}})}break;case "resetRuntimeSettings":try{c[g.instanceID].resetRuntimeSettings(),postMessage({type:"task",id:g.id,body:{success:!0}})}catch(d){postMessage({type:"task",
id:g.id,body:{success:!1,exception:d.message||d}})}break;case "clearCache":try{a.clearCache(),postMessage({type:"task",id:g.id,body:{success:!0}})}catch(d){postMessage({type:"task",id:g.id,body:{success:!1,exception:d.message||d}})}break;default:postMessage({type:"task",id:g.id,body:{success:!1,exception:"No such task."}})}}}();(function(){var b=w;a.loadWasm=function(){return new Promise(function(f,e){if("loaded"==a._loadWasmStatus)return f();a._loadWasmTaskQueue.push(function(d){if("loaded"==a._loadWasmStatus)return a._loadWasmTaskQueue.next(),
f();if(d)return a._loadWasmTaskQueue.next(),e(a._loadWasmStatus);a._loadWasmStatus="loading";return(new Promise(function(e,f){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm hasn't finish loading.");};if(!b.WebAssembly||"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))throw Error("'Constructor BarcodeReader(productKeys)': The browser doesn't support Webassembly.");
if(p)return a._loadWorker().then(function(){return e()},function(b){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. ex: "+(b.message||b));};return f(b)});var d={locateFile:function(){var b=a._wasmName;if(a._wasmResourcePath||a._resourcesPath){var c=a._wasmResourcePath||a._resourcesPath;"/"!=c.charAt(c.length-1)&&(c+="/");b=c+b}else u&&(b=require("path").join(__dirname,b));return b},onRuntimeInitialized:function(){a._BarcodeReaderWasm=d.BarcodeReaderWasm;
var b=new d.BarcodeReaderWasm("");a.version=b.GetVersion()+"(JS "+a._jsVersion+"."+a._jsEditVersion+")";a._defaultRuntimeSettings=JSON.stringify(a._handleRetJsonString(b.GetRuntimeSettings()));b.delete();a._onLog&&a._onLog("load dbr wasm success, version: "+a.version);u?e():g.then(function(){e()},function(a){f(a)})}};d.onExit=d.onAbort=function(b){a._onLog&&a._onLog(b);a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. Error: "+(b.message||
b));};f(b)};d.print=function(b){a._onLog&&a._onLog(b)};if("undefined"==typeof _dbrLoadWasm){void 0==a._bWithio&&(a._bWithio=u||A&&(a._bCustomWorker||b.onmessage!=a._onWorkerMessage));a._wasmjsName=a._wasmjsName||"dbr-"+a._jsVersion+".wasm"+(a._bWithio?".withio":"")+".min.js";a._wasmName=a._wasmName||"dbr-"+a._jsVersion+(a._bWithio?".withio":"")+".wasm";var h=a._wasmjsName;if(a._wasmjsResourcePath||a._resourcesPath){var k=a._wasmjsResourcePath||a._resourcesPath;"/"!=k.charAt(k.length-1)&&(k+="/");
h=k+h}else u&&(h=require("path").join(__dirname,h));A?importScripts(h):_dbrLoadWasm=require(h)}_dbrLoadWasm(d,c,a)})).then(function(){a._loadWasmStatus="loaded";a._loadWasmTaskQueue.next();f()}).catch(function(b){a._loadWasmStatus=b;a._loadWasmTaskQueue.next();e(b)})},null,["loading"==a._loadWasmStatus])})};a._loadWasmTaskQueue=function(){var a=new r;a.timeout=0;return a}();a._openDb=function(){var a=this;return new Promise(function(b,c){var e=function(){d.result.createObjectStore("info");d.result.createObjectStore("wasm");
d.result.createObjectStore("license");d.result.createObjectStore("consume")},f="open db ["+a._dbName+"] fail",d=indexedDB.open(a._dbName,1);d.onupgradeneeded=e;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){var g=d.error.message||d.error;-1!=g.indexOf("version")?(d=indexedDB.deleteDatabase(a._dbName),d.onsuccess=function(){var d=indexedDB.open(a._dbName,1);d.onupgradeneeded=e;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){c(f)}},d.onerror=function(){c(f)}):
c(f+": "+g)}})};a._lookupInDatabase=function(a,b,c){return new Promise(function(e,f){var d=a.transaction([b]).objectStore(b),g=c?d.get(c):d.getAll();g.onsuccess=function(){g.result?e(g.result):f(c+" was not found in "+b)}})};a._storeInDatabase=function(a,b,c,d){return new Promise(function(e,f){var g=a.transaction([b],"readwrite").objectStore(b).put(d,c);g.onerror=function(){f("Failed to store "+c+" in indexDB: "+(g.error.message||g.error))};g.onsuccess=function(){e("Successfully stored "+c+" in "+
b)}})};a._deleteInDatabase=function(a,b,c){return new Promise(function(e,d){var f=a.transaction([b],"readwrite").objectStore(b),g=c?f.delete(c):f.clear();g.onerror=function(){d("Failed to delete "+c+" in indexDB: "+(g.error.message||g.error))};g.onsuccess=function(){e("Successfully delete "+c+" in "+b)}})};var c=function(b,c,h){a._onLog&&a._onLog("start handle dbr wasm, version: "+b);var e=(new Date).getTime();if(u)return new Promise(function(b,d){require("fs").readFile(c,function(c,f){if(c)return d(c);
var g=(new Date).getTime();b(WebAssembly.instantiate(f,h).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-g));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)}))})});var f=function(a){return new Promise(function(b,c){var e=a.transaction(["info"]).objectStore("info").get("bSupportStoreModuleInDb"),d=function(){var e=a.transaction(["info"],"readwrite").objectStore("info"),d=new Uint8Array([0,
97,115,109,1,0,0,0,1,5,1,96,0,1,127,3,2,1,0,7,6,1,2,95,97,0,0,10,6,1,4,0,65,1,11]);try{var f=e.put(new WebAssembly.Module(d.buffer),"testStoreModule");f.onsuccess=function(){e.put(!0,"bSupportStoreModuleInDb").onsuccess=function(){b("set bSupportStoreModuleInDb = true success")}};f.onerror=function(){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(f.error.message||f.error))}}catch(z){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+
(z.message||z))}};e.onsuccess=function(){e.result?b("bSupportStoreModuleInDb == true"):d()}})};return(a._bUseIndexDB?a._openDb():Promise.reject("bUseIndexDB false")).then(function(b){a._onLog&&a._onLog("open db success");g=d();return f(b).then(function(b){a._onLog&&a._onLog(b);return Promise.resolve(!0)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.resolve(!1)}).then(function(d){var f=(new Date).getTime();return a._lookupInDatabase(b,"wasm",a._wasmName).then(function(c){if(c instanceof
WebAssembly.Module){a._onLog&&a._onLog("get a wasm module from db, timecost:"+((new Date).getTime()-f));var g=(new Date).getTime();return WebAssembly.instantiate(c,h).then(function(b){a._onLog&&a._onLog("build instance from module timecost: "+((new Date).getTime()-g));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve({module:c,instance:b})})}a._onLog&&a._onLog("get a wasm binary from db, timecost:"+((new Date).getTime()-f));var l=(new Date).getTime();
return WebAssembly.instantiate(c,h).then(function(c){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-l));if(d){var f=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-f));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(c)})}a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-
e));return Promise.resolve(c)})},function(f){a._onLog&&a._onLog(f.message||f);a._onLog&&a._onLog("downloading...");var g=(new Date).getTime();return d?WebAssembly.instantiateStreaming(fetch(c),h).then(function(c){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("download with build timecost: "+((new Date).getTime()-g));var f=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-f));a._onLog&&
a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}):fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(c){a._onLog&&a._onLog("download timecost: "+((new Date).getTime()-g));a._onWasmDownloaded&&a._onWasmDownloaded();var e=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,
c).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-e));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}).then(function(b){var c=(new Date).getTime();return WebAssembly.instantiate(b,h).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-c));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)})})})})},
function(b){a._onLog&&a._onLog(b.message||b);g=d();return WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch(c),h).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)}):fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();return WebAssembly.instantiate(b,
h).then(function(b){a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-e));return Promise.resolve(b)})})})},g,d=function(){var c=a.productKeys,e=(new Date).getTime();if(!c||8!=c.length)return Promise.resolve(!1);var d=null,g=!1;return a._lookupInDatabase(a._DB,"license",c).then(function(a){d=a;g=d["next-expire-time"]<e},function(){g=!0}).then(function(){a._onLog&&a._onLog("licenseResponseFromDB:");a._onLog&&a._onLog(d);a._onLog&&a._onLog("bNeedGetFromServer: "+g);
return g?fetch(a._licenseUrl+(d?"Cache":"")+"?key="+c+"&version=1"+(d?"&uuid="+d.uuid:"")).then(function(a){if(a.ok)return a.text();throw Error("Network Error: fetch licenseinfo.");}).then(function(b){b=JSON.parse(atob(b));a._onLog&&a._onLog("licenseResponseFromServer:");a._onLog&&a._onLog(b);if("ok"==b.status)return a._runtimeLicenseResponse=b,b["next-expire-time"]=e+1E3*b["min-expire-during"],b["max-expire-time"]=e+1E3*b["max-expire-during"],a._storeInDatabase(a._DB,"license",c,b).catch(function(b){a._onLog&&
a._onLog("store update to db fail:"+(b.message||b))});if("error"==b.status)throw Error(b.message);if("exceeded"==b.status)throw Error("Authorized Scan Count Reached.");throw Error("Unknow Response: fetch licenseinfo.");}).catch(function(b){a._onLog&&a._onLog(b.message||b);if(d&&d["max-expire-time"]>e)return d["next-expire-time"]=e+1E3*d["check-interval-after-expire"],a._runtimeLicenseResponse=d,a._storeInDatabase(a._DB,"license",c,d).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+
(b.message||b))});throw Error("Can't get valid licenseinfo from runtimekey. Message: "+b.message);}):a._runtimeLicenseResponse=d}).then(function(){return a._lookupInDatabase(a._DB,"consume").then(function(c){c.length&&(a._deleteInDatabase(a._DB,"consume"),b._dbrConsume(c))},function(){})})};a.clearCache=function(){return new Promise(function(b,c){if(p){var e=Math.random();a._workerCallbackDic[e]=function(a){return a.success?b():c(a.exception)};a._dbrWorker.postMessage({type:"clearCache",id:e})}else A&&
a._deleteInDatabase(a._DB,"wasm").then(function(){return a._deleteInDatabase(a._DB,"license")}).then(function(){return a._deleteInDatabase(a._DB,"info")}).then(function(){b()},function(a){c(a)})})};var m=!0;b._dbrConsume=function(b){a._onLog&&a._onLog(b);var c=b instanceof Array?b:[b],d=function(){for(var b=0;b<c.length;++b)a._storeInDatabase(a._DB,"consume",Math.random().toString(),c[b]).catch(function(b){a._onLog&&a._onLog(b)})};if(m){m=!1;var f=a._runtimeLicenseResponse["post-urls"],g=[];for(b=
0;b<c.length;++b)g.push(encodeURIComponent(c[b]));var n=function(){return fetch(f[a._indexPostUrl],{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",body:"data="+JSON.stringify(g),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){if(!a.ok)throw Error("consume status: "+a.status);}).catch(function(b){a._onLog&&a._onLog(""+(b.message||b));if(++a._indexPostUrl<f.length)return n();a._indexPostUrl=0;d()})};return n()}d()}})();if(p){var G=w;a.Scanner=function(a){a=
a||{};var b;(b=a.UIElement||a.htmlElement)||(b=document.createElement("div"),b.style.width="100%",b.style.minWidth="100px",b.style.height="100%",b.style.minHeight="100px",b.style.left="0",b.style.top="0",b.style.background="#eee",b.style.display="none",b.innerHTML='<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p><video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video><canvas class="dbrScanner-cvs-draw-area" style="width:100%;height:100%;position:absolute;left:0;top:0;"></canvas><select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;"></select><select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;"></select><button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;"><svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button>');
this.UIElement=b;this.videoSettings=a.videoSettings||{video:{}};b=this.videoSettings.video;b.width||b.height||(b.width={ideal:1280},b.height={ideal:720});b.deviceId||b.facingMode||(b.facingMode={ideal:"environment"});this.intervalTime=a.intervalTime;void 0==this.intervalTime&&(this.intervalTime=100);this.runtimeSettings=a.runtimeSettings;this.searchRegion=a.searchRegion||{sx:void 0,sy:void 0,sWidth:void 0,sHeight:void 0,dWidth:void 0,dHeight:void 0};this.bAddOriVideoCanvasToResult=a.bAddOriVideoCanvasToResult;
this.bAddSearchRegionCanvasToResult=a.bAddSearchRegionCanvasToResult;this.onFrameRead=a.onFrameRead;this.duplicateForgetTime=a.duplicateForgetTime;void 0==this.duplicateForgetTime&&(this.duplicateForgetTime=3E3);this.onUnduplicatedRead=a.onUnduplicatedRead||a.onNewCodeRead;this.barcodeReader=null;this._isOpen=!1;this._lastDeviceId=void 0;this.arrDiffCodeInfo=[];this._intervalDetectVideoPause=1E3;this._bTryTakePhoto=a._bTryTakePhoto;this._photoSettings=a._photoSettings||{};this._imageCapture=this._advancedVideoSettings=
null;this._videoOrientation=void 0;this._videoTrack=this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=this._videoCapabilities=null;this._frameCount=0;this._1DRememberFrameCount=5;this._1DTrustFrameCount=2};a.Scanner.loadWasm=a.loadWasm;a.Scanner.isLoaded=function(){return a.isLoaded()};a.Scanner.createInstance=function(b){return a.createInstance().then(function(c){var g=b instanceof a.Scanner?b:new a.Scanner(b);g.barcodeReader=c;var d=c.getRuntimeSettings();d.localizationModes=
[2,0,0,0,0,0,0,0];d.deblurLevel=2;if(g.runtimeSettings)for(var m in g.runtimeSettings)void 0!=d[m]&&(d[m]=g.runtimeSettings[m]);delete g.runtimeSettings;c.updateRuntimeSettings(d);return g})};a.Scanner.prototype.getUIElement=function(){return this.UIElement};a.Scanner.prototype.setUIElement=function(a){this.UIElement=a};a.Scanner.prototype.destroy=a.Scanner.prototype.deleteInstance=function(){this.barcodeReader&&this.barcodeReader.deleteInstance()};a.Scanner.prototype.getScanSettings=function(){return{duplicateForgetTime:this.duplicateForgetTime,
intervalTime:this.intervalTime}};a.Scanner.prototype.setScanSettings=function(a){this.duplicateForgetTime=a.duplicateForgetTime;this.intervalTime=a.intervalTime};a.Scanner.prototype.getRuntimeSettings=function(){return this.barcodeReader.getRuntimeSettings()};a.Scanner.prototype.updateRuntimeSettings=function(a){return this.barcodeReader.updateRuntimeSettings(a)};a.Scanner.prototype.resetRuntimeSettings=function(){this.barcodeReader.resetRuntimeSettings()};a.Scanner.prototype._bindUI=function(){for(var a=
[this.UIElement],c=$jscomp.makeIterator(this.UIElement.children),g=c.next();!g.done;g=c.next())a.push(g.value);for(c=0;c<a.length;++c){var d=$jscomp.makeIterator(a[c].children);for(g=d.next();!g.done;g=d.next())a.push(g.value)}a=$jscomp.makeIterator(a);for(g=a.next();!g.done;g=a.next())g=g.value,!this._video&&g.classList.contains("dbrScanner-video")?this._video=g:!this._cvsDrawArea&&g.classList.contains("dbrScanner-cvs-drawArea")?this._cvsDrawArea=g:!this._selCam&&g.classList.contains("dbrScanner-sel-camera")?
this._selCam=g:!this._selRsl&&g.classList.contains("dbrScanner-sel-resolution")?(this._selRsl=g,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="2560" data-height="1440">ask 2560 x 1440</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option>'].join(""),
this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&g.classList.contains("dbrScanner-opt-gotResolution")?this._optGotRsl=g:!this._btnClose&&g.classList.contains("dbrScanner-btn-close")&&(this._btnClose=g);if(!this._video)throw this._unBindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.");};a.Scanner.prototype._unBindUI=function(){this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=null};a.Scanner.prototype.getVideoSettings=
function(){return JSON.parse(JSON.stringify(this.videoSettings))};a.Scanner.prototype.updateVideoSettings=function(a){this.videoSettings=JSON.parse(JSON.stringify(a));return this._isOpen?this.play():Promise.resolve()};a.Scanner.prototype.isOpen=function(){return this._isOpen};a.Scanner.prototype.show=a.Scanner.prototype.open=function(){var b=this;if(!navigator.mediaDevices)return Promise.reject("`navigator.mediaDevices` is not available. Please ensure that you host the site in https.");if(this._isOpen)return Promise.reject("The scanner is already open.");
this._isOpen=!0;this.arrDiffCodeInfo=[];this._frameCount=0;this._lastDeviceId=void 0;try{this._bindUI()}catch(k){return Promise.reject(k)}var c=function(){b.play(b._selCam.value).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selCam&&this._selCam.addEventListener("change",c);var g=function(){if(b._selRsl&&-1!=b._selRsl.selectedIndex){var a=b._selRsl.options[b._selRsl.selectedIndex];var c=a.getAttribute("data-width");a=a.getAttribute("data-height")}b.play(void 0,
c,a).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selRsl&&this._selRsl.addEventListener("change",g);var d=this._closeWindow=function(){b.stop();b._isOpen=!1;b._selCam&&b._selCam.removeEventListener("change",c);b._selRsl&&b._selRsl.removeEventListener("change",g);b._closeWindow=void 0;b._btnClose&&b._btnClose.removeEventListener("click",d);b.UIElement.style.display="none"};this._btnClose&&this._btnClose.addEventListener("click",d);this.UIElement.parentNode||
(this.UIElement.style.position||(this.UIElement.style.position="fixed"),document.body.appendChild(this.UIElement));"none"==this.UIElement.style.display&&(this.UIElement.style.display="");var m,f,e=this.play().then(function(a){m=a;return b.updateDevice()}).then(function(a){f=a;return Promise.resolve()});var h=b.barcodeReader?Promise.resolve():a.Scanner.createInstance(b);return Promise.all([e,h]).then(function(){if(!b._isOpen)return b.stop();b._loopReadVideo();return Promise.resolve({width:m.width,
height:m.height,current:f.current,all:f.all})})};a.Scanner.prototype.play=function(b,c,g){var d=this;return this._isOpen?new Promise(function(m,f){d.stop();a._onLog&&a._onLog("======before video========");var e=d.videoSettings;if(/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))1280<=c?e.video.width=1280:640<=c?e.video.width=640:320<=c&&(e.video.width=320);else if(c||g)c&&(e.video.width={ideal:c}),g&&(e.video.height={ideal:g});b?(delete e.video.facingMode,
e.video.deviceId={exact:b},d._lastDeviceId=b):!e.video.deviceId&&d._lastDeviceId&&(delete e.video.facingMode,e.video.deviceId={ideal:d._lastDeviceId});var h=!1,k=function(){a._onLog&&a._onLog("======try getUserMedia========");a._onLog&&a._onLog("ask "+JSON.stringify(e.video.width)+"x"+JSON.stringify(e.video.height));navigator.mediaDevices.getUserMedia(e).then(function(b){a._onLog&&a._onLog("======get video========");return new Promise(function(c,e){var f=b.getVideoTracks();f.length&&(d._videoTrack=
f[0],G.ImageCapture&&(d._imageCapture=new ImageCapture(d._videoTrack)));d._video.srcObject=b;d._video.onloadedmetadata=function(){a._onLog&&a._onLog("======play video========");d._video.play().then(function(){a._onLog&&a._onLog("======played video========");d._videoTrack.applyConstraints&&d._videoTrack.getCapabilities&&(d._videoCapabilities=d._videoTrack.getCapabilities(),d._advancedVideoSettings={});var b="got "+d._video.videoWidth+"x"+d._video.videoHeight;d._optGotRsl&&(d._optGotRsl.setAttribute("data-width",
d._video.videoWidth),d._optGotRsl.setAttribute("data-height",d._video.videoHeight),d._optGotRsl.innerText=b,d._selRsl&&d._optGotRsl.parentNode==d._selRsl&&(d._selRsl.value="got"));a._onLog&&a._onLog(b);c();m({width:d._video.videoWidth,height:d._video.videoHeight})},function(a){e(a)})};d._video.onerror=function(){e()}})}).catch(function(b){a._onLog&&a._onLog(b);!h&&e.video?(h=!0,e.video.width=void 0,e.video.height=void 0,k()):f(b)})};k()}):Promise.reject("The scanner is not open.")};a.Scanner.prototype.pause=
function(){this._video&&this._video.pause()};a.Scanner.prototype.stop=function(){this._video&&this._video.srcObject&&(a._onLog&&a._onLog("======stop video========"),this._video.srcObject.getTracks().forEach(function(a){a.stop()}),this._videoOrientation=this._videoTrack=this._video.srcObject=null)};a.Scanner.prototype.hide=a.Scanner.prototype.close=function(){this._isOpen&&this._closeWindow()};a.Scanner.prototype.getCurrentCamera=function(){return this.updateDevice().then(function(a){return a.current})};
a.Scanner.prototype.getAllCameras=function(){return this.updateDevice().then(function(a){return a.all})};a.Scanner.prototype.setCurrentCamera=function(a){return this.play(a.deviceId||a)};a.Scanner.prototype.updateDevice=function(){var a=this;return navigator.mediaDevices.enumerateDevices().then(function(b){var c=[],d;if(a._selCam){var m=a._selCam.value;a._selCam.innerHTML=""}for(var f=0;f<b.length;++f){var e=b[f];if("videoinput"==e.kind){var h={};h.deviceId=e.deviceId;h.label=e.label||"camera "+f;
c.push(h)}}b=void 0;if(a._video)for(f=$jscomp.makeIterator(a._video.srcObject.getVideoTracks()),e=f.next();!e.done;e=f.next()){e=e.value;if(b)break;h=$jscomp.makeIterator(c);for(var k=h.next();!k.done;k=h.next())if(k=k.value,e.label==k.label){b=k;a._lastDeviceId=k.deviceId;break}}if(a._selCam){f=$jscomp.makeIterator(c);for(k=f.next();!k.done;k=f.next())e=k.value,h=document.createElement("option"),h.value=e.deviceId,h.innerText=e.label,a._selCam.appendChild(h),m==e.deviceId&&(d=h);m=a._selCam.childNodes;
if(!d&&b&&m.length)for(m=$jscomp.makeIterator(m),f=m.next();!f.done;f=m.next())if(f=f.value,b.label==f.innerText){d=f;break}d&&(a._selCam.value=d.value)}return Promise.resolve({current:b,all:c})})};a.Scanner.prototype.getResolution=function(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null};a.Scanner.prototype.setResolution=function(a,c){return this._isOpen?(a instanceof Array&&(a=a[0],c=a[1]),this.play(null,a,c)):Promise.reject()};a.Scanner.prototype.getCompatibility=function(){return{torch:this._videoCapabilities?
this._videoCapabilities.torch||!1:!1,focus:!1}};a.Scanner.prototype.turnOnTorch=function(){return this.isSupportTorch()?(this._advancedVideoSettings.torch=!0,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):Promise.reject("not support")};a.Scanner.prototype.turnOffTorch=function(){return this.isSupportTorch?(this._advancedVideoSettings.torch=!1,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):Promise.reject("not support")};a.Scanner.prototype._cloneDecodeResults=
function(a,c){if(a instanceof Array){var b=[];a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())b.push(this._cloneDecodeResults(d.value,c));return b}b=JSON.parse(JSON.stringify(a,function(a,b){if("oriVideoCanvas"!=a&&"searchRegionCanvas"!=a)return b}));c||(b.oriVideoCanvas=a.oriVideoCanvas,b.searchRegionCanvas=a.searchRegionCanvas);return b};a.Scanner.prototype._loopReadVideo=function(){var b=this;if(this._isOpen)if(this._video.paused)a._onLog&&a._onLog("Video is paused. Ask in 1s."),
setTimeout(function(){b._loopReadVideo()},this._intervalDetectVideoPause);else{a._onLog&&a._onLog("======= once read =======");var c=(new Date).getTime();(function(){var a=JSON.parse(JSON.stringify(b.searchRegion));a.bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;a.bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;return!b._bTryTakePhoto||!b._imageCapture||b._advancedVideoSettings&&b._advancedVideoSettings.torch||"live"!=b._videoTrack.readyState||!b._videoTrack.enabled||b._videoTrack.muted?
b.barcodeReader.decodeVideo.apply(b.barcodeReader,[b._video,a]):b._imageCapture.takePhoto(b._photoSettings).then(function(c){a.videoWidth=b._video.videoWidth;a.videoHeight=b._video.videoHeight;return b._videoOrientation||"image/jpeg"!=c.type?c:new Promise(function(a){D.getData(c,function(){b._videoOrientation=D.getTag(this,"Orientation");a(c)})})}).then(function(c){a._videoOrientation=b._videoOrientation;return b.barcodeReader._decodeBlob(c,a)})})().then(function(g){var d=(new Date).getTime();a._onLog&&
a._onLog("time cost: "+(d-c)+"ms");++b._frameCount;a._onLog&&a._onLog(g);for(var m=[],f=$jscomp.makeIterator(g),e=f.next();!e.done;e=f.next()){e=e.value;for(var h=!1,k=0;k<b.arrDiffCodeInfo.length;++k){var p=b.arrDiffCodeInfo[k];if(p.result.BarcodeText==e.BarcodeText&&p.result.BarcodeFormat==e.BarcodeFormat){p.time=d;p.result=b._cloneDecodeResults(e,!0);++p.count;h=!0;0!=(e.BarcodeFormat&a.EnumBarcodeFormat.OneD)&&(k=p.frameCounts,k.push(b._frameCount),k.length==b._1DTrustFrameCount?m.push(e):k.length>
b._1DTrustFrameCount&&k.shift());break}}h||(b.arrDiffCodeInfo.push({result:b._cloneDecodeResults(e,!0),time:d,count:1}),0==(e.BarcodeFormat&a.EnumBarcodeFormat.OneD)?m.push(e):b.arrDiffCodeInfo[b.arrDiffCodeInfo.length-1].frameCounts=[b._frameCount])}for(f=0;f<b.arrDiffCodeInfo.length;++f)e=b.arrDiffCodeInfo[f],e.time+b.duplicateForgetTime<d&&(0==(e.result.BarcodeFormat&a.EnumBarcodeFormat.OneD)?b.arrDiffCodeInfo.splice(f,1):(e=e.frameCounts,b._frameCount-e[e.length-1]>=b._1DRememberFrameCount&&b.arrDiffCodeInfo.splice(f,
1)));if(b.onFrameRead)b.onFrameRead(b._cloneDecodeResults(g));g=$jscomp.makeIterator(m);for(e=g.next();!e.done;e=g.next())if(d=e.value,b.onUnduplicatedRead)b.onUnduplicatedRead(d.BarcodeText,b._cloneDecodeResults(d));setTimeout(function(){b._loopReadVideo()},b.intervalTime)}).catch(function(c){a._onLog&&a._onLog(c.message||c);setTimeout(function(){b._loopReadVideo()},b.intervalTime);if("platform error"!=c.message)throw console.error(c.message),c;})}}}a.BarcodeScanner=a.Scanner;var D=p?function(){function a(a,
b){b||a.match(/^data:([^;]+);base64,/mi);a=a.replace(/^data:([^;]+);base64,/gmi,"");a=atob(a);b=a.length;for(var c=new ArrayBuffer(b),e=new Uint8Array(c),d=0;d<b;d++)e[d]=a.charCodeAt(d);return c}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};c.send()}function g(b,f){function g(a){var c=d(a);a:{var g=new DataView(a);if(255!=g.getUint8(0)||216!=g.getUint8(1))g=!1;else{for(var l=2,q=a.byteLength;l<
q;){var h=g,t=l;if(56===h.getUint8(t)&&66===h.getUint8(t+1)&&73===h.getUint8(t+2)&&77===h.getUint8(t+3)&&4===h.getUint8(t+4)&&4===h.getUint8(t+5)){h=g.getUint8(l+7);0!==h%2&&(h+=1);0===h&&(h=4);q=l+8+h;l=g.getUint16(l+6+h);g=q;q=new DataView(a);h={};for(t=g;t<g+l;){if(28===q.getUint8(t)&&2===q.getUint8(t+1)){var k=q.getUint8(t+2);if(k in w){var B=q.getInt16(t+3);k=w[k];B=e(q,t+5,B);h.hasOwnProperty(k)?h[k]instanceof Array?h[k].push(B):h[k]=[h[k],B]:h[k]=B}}t++}g=h;break a}l++}g=void 0}}a:if("DOMParser"in
self)if(l=new DataView(a),255!=l.getUint8(0)||216!=l.getUint8(1))var m=!1;else{q=2;h=a.byteLength;for(a=new DOMParser;q<h-4;)if("http"==e(l,q,4)){h=q-1;q=l.getUint16(q-2)-1;l=e(l,h,q);q=l.indexOf("xmpmeta>")+8;l=l.substring(l.indexOf("<x:xmpmeta"),q);q=l.indexOf("x:xmpmeta")+10;l=l.slice(0,q)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
l.slice(q);b:{a=a.parseFromString(l,"text/xml");try{l={};if(0<a.children.length)for(q=0;q<a.children.length;q++){var n=a.children.item(q),C=n.attributes,p;for(p in C){var r=C[p],z=r.nodeName,F=r.nodeValue;void 0!==z&&(l[z]=F)}var u=n.nodeName;if("undefined"==typeof l[u])l[u]=xml2json(n);else{if("undefined"==typeof l[u].push){var v=l[u];l[u]=[];l[u].push(v)}l[u].push(xml2json(n))}}else l=a.textContent;m=l;break b}catch(H){console.log(H.message)}m=void 0}break a}else q++;m=void 0}else m=void 0;b.exifdata=
c||{};b.iptcdata=g||{};b.xmpdata=m||{};f&&f.call(b)}if(b.src)if(/^data:/i.test(b.src)){var l=a(b.src);g(l)}else if(/^blob:/i.test(b.src)){var q=new FileReader;q.onload=function(a){g(a.target.result)};c(b.src,function(a){q.readAsArrayBuffer(a)})}else{var h=new XMLHttpRequest;h.onload=function(){if(200==this.status||0===this.status)g(h.response);else throw"Could not load image";h=null};h.open("GET",b.src,!0);h.responseType="arraybuffer";h.send(null)}else self.FileReader&&(b instanceof self.Blob||b instanceof
self.File)&&(q=new FileReader,q.onload=function(a){g(a.target.result)},q.readAsArrayBuffer(b))}function d(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var e;c<a;){if(255!=b.getUint8(c))return!1;e=b.getUint8(c+1);if(225==e)return h(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function m(a,b,c,e,d){var g=a.getUint16(c,!d),l={},q;for(q=0;q<g;q++){var h=c+12*q+2;var t=e[a.getUint16(h,!d)];l[t]=f(a,h,b,c,d)}return l}function f(a,b,c,d,f){var g=
a.getUint16(b+2,!f);d=a.getUint32(b+4,!f);c=a.getUint32(b+8,!f)+c;switch(g){case 1:case 7:if(1==d)return a.getUint8(b+8,!f);c=4<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint8(c+g);return b;case 2:return e(a,4<d?c:b+8,d-1);case 3:if(1==d)return a.getUint16(b+8,!f);c=2<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint16(c+2*g,!f);return b;case 4:if(1==d)return a.getUint32(b+8,!f);b=[];for(g=0;g<d;g++)b[g]=a.getUint32(c+4*g,!f);return b;case 5:if(1==d){var l=a.getUint32(c,!f);var h=a.getUint32(c+4,!f);a=new Number(l/
h);a.numerator=l;a.denominator=h;return a}b=[];for(g=0;g<d;g++)l=a.getUint32(c+8*g,!f),h=a.getUint32(c+4+8*g,!f),b[g]=new Number(l/h),b[g].numerator=l,b[g].denominator=h;return b;case 9:if(1==d)return a.getInt32(b+8,!f);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+4*g,!f);return b;case 10:if(1==d)return a.getInt32(c,!f)/a.getInt32(c+4,!f);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+8*g,!f)/a.getInt32(c+4+8*g,!f);return b}}function e(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}
function h(a,b){if("Exif"!=e(a,b,4))return!1;var c=b+6;if(18761==a.getUint16(c))var d=!1;else if(19789==a.getUint16(c))d=!0;else return!1;if(42!=a.getUint16(c+2,!d))return!1;var f=a.getUint32(c+4,!d);if(8>f)return!1;b=m(a,c,c+f,n,d);if(b.ExifIFDPointer){var g=m(a,c,c+b.ExifIFDPointer,p,d);for(h in g){switch(h){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":g[h]=
v[h][g[h]];break;case "ExifVersion":case "FlashpixVersion":g[h]=String.fromCharCode(g[h][0],g[h][1],g[h][2],g[h][3]);break;case "ComponentsConfiguration":g[h]=v.Components[g[h][0]]+v.Components[g[h][1]]+v.Components[g[h][2]]+v.Components[g[h][3]]}b[h]=g[h]}}if(b.GPSInfoIFDPointer)for(h in g=m(a,c,c+b.GPSInfoIFDPointer,r,d),g){switch(h){case "GPSVersionID":g[h]=g[h][0]+"."+g[h][1]+"."+g[h][2]+"."+g[h][3]}b[h]=g[h]}var h=d;f=c+f;d=a.getUint16(f,!h);if(f=a.getUint32(f+2+12*d,!h))if(f>a.byteLength)a=
{};else{h=m(a,c,c+f,u,h);if(h.Compression)switch(h.Compression){case 6:h.JpegIFOffset&&h.JpegIFByteCount&&(h.blob=new Blob([new Uint8Array(a.buffer,c+h.JpegIFOffset,h.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",h.Compression)}else 2==h.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");a=h}else a={};b.thumbnail=
a;return b}var k=function(a){if(a instanceof k)return a;if(!(this instanceof k))return new k(a);this.EXIFwrapped=a},p=k.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",
33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",
41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},n=k.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",
34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",
532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},r=k.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",
21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},u=k.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",
296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},v=k.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",
1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",
3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},w={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};k.getData=
function(a,b){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?b&&b.call(a):g(a,b);return!0};k.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};k.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};k.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};k.getAllIptcTags=function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;
var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};k.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};k.readFromBinaryFile=function(a){return d(a)};return k}():void 0;return a});
